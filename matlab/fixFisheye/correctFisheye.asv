function [newIMG] = correctFisheye(img)

Orig = [171 271;
    899 271;
    1413 259;
    2386 276;
    1138 1032;
    153 1265;
    2404 1260;
    171 1760;
    905 1783;
    1413 1788;
    2398 1754];

Corr = [123 253;
    899 259;
    1419 259;
    2428 259;
    1156 1021;
    129 1282;
    2428 1282;
    129 1810;
    899 1810;
    1413 1810;
    2428 1810];

% Orig =[167 279;
%     406 271;
%     649 268;
%     898 265;
%     1155 262;
%     1403 261;
%     1657 265;
%     1900 271;
%     2146 274;
%     2379 279;
%     159 523;
%     406 519;
%     648 515;
%     909 512;
%     1152 510;
%     1402 510;
%     1663 513;
%     1908 516;
%     2152 519;
%     2386 525;
%     153 770;
%     394 768;
%     649 767;
%     894 766;
%     1157 766;
%     1403 765;
%     1664 767;
%     1921 768;
%     2167 769;
%     2397 771;
%     151 1019;
%     391 1021;
%     643 1024;
%     891 1024;
%     1153 1025;
%     1407 1025;
%     1663 1024;
%     1921 1023;
%     2167 1022;
%     2403 1020;
%     143 1268;
%     394 1274;
%     644 1279;
%     891 1282;
%     1150 1283;
%     1413 1285;
%     1670 1282;
%     1917 1278;
%     2174 1274;
%     2400 1270;
%     151 1516;
%     398 1525;
%     641 1531;
%     898 1535;
%     1155 1538;
%     1413 1538;
%     1666 1535;
%     1915 1530;
%     2159 1524;
%     2412 1515;
%     160 1765;
%     401 1773;
%     650 1780;
%     894 1785;
%     1159 1788;
%     1410 1787;
%     1659 1784;
%     1909 1778;
%     2161 1770;
%     2398 1761];
% 
% Corr = [127 258;
%     384 258;
%     638 258;
%     897 258;
%     1154 258;
%     1404 258;
%     1662 258;
%     1918 268;
%     2178 258;
%     2434 258;
%     127 510;
%     384 510;
%     638 510;
%     897 510;
%     1154 510;
%     1404 510;
%     1662 510;
%     1918 510;
%     2178 510;
%     2434 510
%     127 772;
%     384 772;
%     638 772;
%     897 772;
%     1154 772;
%     1404 772;
%     1662 772;
%     1918 772;
%     2178 772;
%     2434 772;
%     127 1022;
%     384 1022;
%     638 1022;
%     897 1022;
%     1154 1022;
%     1404 1022;
%     1662 1022;
%     1918 1022;
%     2178 1022;
%     2434 1022;
%     127 1284;
%     384 1284;
%     638 1284;
%     897 1284;
%     1154 1284;
%     1404 1284;
%     1662 1284;
%     1918 1284;
%     2178 1284;
%     2434 1284;
%     127 1540;
%     384 1540;
%     638 1540;
%     897 1540;
%     1154 1540;
%     1404 1540;
%     1662 1540;
%     1918 1540;
%     2178 1540;
%     2434 1540;
%     127 1799;
%     384 1799;
%     638 1799;
%     897 1799;
%     1154 1799;
%     1404 1799;
%     1662 1799;
%     1918 1799;
%     2178 1799;
%     2434 1799];


trainX = [ones(length(Orig),1) Orig(:,1) Orig(:,1).^2 Orig(:,1).*Orig(:,2) Orig(:,2) Orig(:,2).^2];
trainY = [Corr(:,1) Corr(:,2)];
trainX = double(trainX);
trainY = double(trainY);

W = inv(trainX'*trainX)*(trainX'*trainY);

%have to change this to map backwards so that we do not have missing
%pixels...easy fix just make 
newIMG = zeros(size(img,1), size(img,2));
for x=1:size(img,1)
    for y=1:size(img,2)
        [newX] = [1 x x.^2 x*y y y.^2]*W(:,1);
        [newY] = [1 x x.^2 x*y y y.^2]*W(:,2);
        newX = round(newX);
        newY = round(newY);
        if(newX >0 && newX<=size(img,1) && newY > 0 && newY < size(img,2))
            newIMG(newX,newY) = img(x,y);
        end
    end
end

